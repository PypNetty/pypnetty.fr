---
import Layout from "../layouts/Layout.astro";
import MetalFarmDiagram from "../components/MetalFarmDiagram.astro";
import { getCollection } from "astro:content";
import { formatDate } from "../utils/formatDate";

const allPosts = await getCollection("blog", ({ data }) => !data.draft);
const recentPosts = allPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

const projects = [
  {
    title: "The Metal Farm (Bare Metal K8s)",
    description:
      "Conception et exploitation d'un cluster Kubernetes industriel sur mat√©riel physique. Automatisation compl√®te du provisionnement (PXE/MaaS) pour traiter les n≈ìuds comme du b√©tail (Cattle). Z√©ro hyperviseur pour une performance brute et une latence minimale.",
    tags: ["Kubernetes", "Bare Metal", "Automation", "Linux", "PXE"],
    link: "#", // Id√©alement vers un repo Ansible/Terraform ou un sch√©ma d'archi
    status: "Production",
  },
];
---

<Layout
  title="PypNetty - plateform enginner and resilience architect"
  description="Ing√©nieur DevOps"
>
  <!-- Hero Section -->
  <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-24 sm:py-32">
    <div class="space-y-6">
      <h1 class="text-5xl sm:text-6xl font-bold leading-tight">
        Plateform Engineer.<br />
        <span class="text-accent">Resilience Architect</span>
      </h1>
      <p class="text-xl text-zinc-400 max-w-2xl">
        Je construis des produits cloud-native en Go et partage mon parcours
        dans le d√©veloppement de solutions DevSecOps.
      </p>
      <div class="flex flex-wrap gap-4 pt-4">
        <a
          href="/blog"
          class="px-6 py-3 bg-accent text-zinc-950 font-semibold rounded-lg hover:bg-accent/90 transition-colors inline-flex items-center gap-2"
        >
          Lire le blog
          <span class="text-lg">‚Üí</span>
        </a>
        <a
          href="#projects"
          class="px-6 py-3 border border-zinc-700 text-zinc-100 font-semibold rounded-lg hover:border-accent hover:text-accent transition-colors inline-flex items-center gap-2"
        >
          <span class="text-sm">‚ñ∏</span>
          Voir mes projets
        </a>
      </div>
    </div>
  </section>

  <!-- Manifesto Section -->
  <section class="max-w-4xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <div class="border-l-2 border-emerald-500 pl-6 py-2 bg-emerald-500/5">
      <p class="text-gray-400 font-mono text-sm mb-2">// PHILOSOPHIE</p>
      <h2 class="text-2xl font-bold text-white mb-4">
        L'abstraction a un prix que je refuse de payer.
      </h2>
      <p class="text-gray-300 leading-relaxed italic">
        "Dans un monde qui s'empile sur des couches de virtualisation, je
        choisis le <strong>Bare Metal</strong>. Je traite l'infrastructure comme
        du b√©tail (Cattle) non pas par manque d'empathie pour le mat√©riel, mais
        par respect pour la disponibilit√©. Si un n≈ìud faillit, il est extermin√©
        et reconstruit. C'est √ßa, la vraie r√©silience."
      </p>
    </div>
  </section>

  <!-- Live Stats Dashboard -->
  <section class="max-w-4xl mx-auto py-8 px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
      <div class="bg-slate-900/50 border border-slate-800 p-4 rounded-lg">
        <p class="text-gray-500 text-xs uppercase font-mono">Nodes</p>
        <p class="text-emerald-400 text-xl font-bold font-mono">05</p>
      </div>
      <div class="bg-slate-900/50 border border-slate-800 p-4 rounded-lg">
        <p class="text-gray-500 text-xs uppercase font-mono">Avg Latency</p>
        <p class="text-emerald-400 text-xl font-bold font-mono">1.2ms</p>
      </div>
      <div class="bg-slate-900/50 border border-slate-800 p-4 rounded-lg">
        <p class="text-gray-500 text-xs uppercase font-mono">Provisioning</p>
        <p class="text-emerald-400 text-xl font-bold font-mono">PXE/MaaS</p>
      </div>
      <div class="bg-slate-900/50 border border-slate-800 p-4 rounded-lg">
        <p class="text-gray-500 text-xs uppercase font-mono">Uptime</p>
        <p class="text-emerald-400 text-xl font-bold font-mono">99.9%</p>
      </div>
    </div>
  </section>

  <!-- Projects Section -->
  <section id="projects" class="max-w-6xl mx-auto py-20 px-4 sm:px-6 lg:px-8">
    <div
      class="bg-slate-900/40 border border-slate-800 rounded-xl overflow-hidden flex flex-col lg:flex-row"
    >
      <div
        class="p-8 lg:w-1/3 border-b lg:border-b-0 lg:border-r border-slate-800"
      >
        <div class="flex items-center gap-2 mb-4">
          <span class="relative flex h-3 w-3">
            <span
              class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"
            ></span>
            <span
              class="relative inline-flex rounded-full h-3 w-3 bg-emerald-500"
            ></span>
          </span>
          <span class="text-xs font-mono text-emerald-500 uppercase"
            >Live Production</span
          >
        </div>
        <h3 class="text-3xl font-bold text-white mb-4 italic">
          The Metal Farm
        </h3>
        <p class="text-gray-400 mb-6 leading-relaxed">
          L'infrastructure ultime pour ceux qui refusent les compromis de la
          virtualisation. Un cluster Kubernetes g√©r√© comme un troupeau,
          directement sur le m√©tal.
        </p>
        <div class="flex flex-wrap gap-2 mb-6">
          {
            ["K8s", "MaaS", "Go", "Bare Metal", "PXE"].map((tag) => (
              <span class="text-[10px] px-2 py-1 bg-slate-800 text-slate-400 rounded font-mono">
                #{tag}
              </span>
            ))
          }
        </div>
        <a
          href="#"
          class="text-emerald-400 hover:text-emerald-300 inline-flex items-center gap-2 text-sm font-semibold transition-colors"
        >
          <span>Voir le code source</span>
          <span>‚Üí</span>
        </a>
      </div>

      <div
        class="p-4 lg:w-2/3 bg-[#020617] flex items-center justify-center group"
      >
        <div
          class="opacity-80 group-hover:opacity-100 transition-opacity w-full"
        >
          <MetalFarmDiagram />
        </div>
      </div>
    </div>
  </section>

  <!-- Tech Stack Section -->
  <section class="max-w-6xl mx-auto py-12 px-4 sm:px-6 lg:px-8">
    <h3 class="text-white font-bold mb-8 flex items-center gap-2">
      <span class="w-2 h-2 bg-emerald-500 rounded-full"></span>
      Core Tech Stack
    </h3>

    <div class="grid lg:grid-cols-[2fr_1fr] gap-8">
      <!-- Piliers de comp√©tences -->
      <div class="grid md:grid-cols-3 gap-6">
        <!-- Pilier 1: Orchestration & OS -->
        <div class="space-y-3">
          <h4
            class="text-emerald-400 font-semibold text-sm uppercase tracking-wide flex items-center gap-2 h-10"
          >
            <span class="text-xs">‚öôÔ∏è</span>
            Orchestration & OS
          </h4>
          <div class="space-y-2">
            {
              ["Talos Linux", "Kubernetes", "K3s", "MaaS", "Ansible"].map(
                (tech) => (
                  <span class="block px-3 py-2 bg-slate-800 border border-slate-700 text-gray-300 text-sm font-mono rounded hover:border-emerald-500 hover:bg-slate-750 transition-all cursor-default">
                    {tech}
                  </span>
                )
              )
            }
          </div>
        </div>

        <!-- Pilier 2: Networking & Security -->
        <div class="space-y-3">
          <h4
            class="text-emerald-400 font-semibold text-sm uppercase tracking-wide flex items-center gap-2 h-10"
          >
            <span class="text-xs">üîí</span>
            Networking & Security
          </h4>
          <div class="space-y-2">
            {
              ["Cilium (eBPF)", "BGP", "MikroTik", "WireGuard", "MetalLB"].map(
                (tech) => (
                  <span class="block px-3 py-2 bg-slate-800 border border-slate-700 text-gray-300 text-sm font-mono rounded hover:border-emerald-500 hover:bg-slate-750 transition-all cursor-default">
                    {tech}
                  </span>
                )
              )
            }
          </div>
        </div>

        <!-- Pilier 3: Storage & Observability -->
        <div class="space-y-3">
          <h4
            class="text-emerald-400 font-semibold text-sm uppercase tracking-wide flex items-center gap-2 h-10"
          >
            <span class="text-xs">üìä</span>
            Storage & Observability
          </h4>
          <div class="space-y-2">
            {
              ["Longhorn", "MinIO (S3)", "Prometheus", "Grafana", "GitOps"].map(
                (tech) => (
                  <span class="block px-3 py-2 bg-slate-800 border border-slate-700 text-gray-300 text-sm font-mono rounded hover:border-emerald-500 hover:bg-slate-750 transition-all cursor-default">
                    {tech}
                  </span>
                )
              )
            }
          </div>
        </div>
      </div>

      <!-- System Status (√† droite) -->
      <div class="bg-slate-950 border border-slate-800 rounded-lg p-6 h-fit">
        <div class="flex items-center gap-2 mb-4">
          <span class="text-emerald-400 font-mono text-xs">$</span>
          <span class="text-gray-400 font-mono text-xs"
            >pypnetty-ctl get-stack --details</span
          >
        </div>
        <pre
          class="font-mono text-xs text-gray-400 leading-relaxed">
<span class="text-emerald-500">[ CLUSTER STATS ]</span>

<span class="text-gray-500">Nodes:</span> <span class="text-white">4 Online</span>
  ‚îú‚îÄ 1x RTX 7090
  ‚îú‚îÄ 2x RTX 7010
  ‚îî‚îÄ 1x Fujitsu

<span class="text-gray-500">Control Plane:</span> <span class="text-emerald-400">HA (3 Nodes)</span>

<span class="text-gray-500">Storage:</span> <span class="text-white">1.8TB</span> Distribu√©
  ‚îî‚îÄ Longhorn CSI

<span class="text-gray-500">Network:</span> <span class="text-emerald-400">BGP Peering OK</span>
  ‚îî‚îÄ MikroTik hEX S

<span class="text-gray-500">Uptime:</span> <span class="text-white">99.94%</span> (30d avg)
        </pre>
      </div>
    </div>
  </section>

  <!-- Recent Posts Section -->
  <section class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-16">
    <h2 class="text-3xl font-bold mb-8">Articles r√©cents</h2>
    <div class="space-y-8">
      {
        recentPosts.map((post) => (
          <article class="border-b border-zinc-800 pb-8 last:border-0">
            <div class="flex flex-wrap gap-2 mb-3">
              {post.data.tags.map((tag) => (
                <span class="text-xs px-3 py-1 rounded-full bg-zinc-900 text-zinc-400">
                  {tag}
                </span>
              ))}
            </div>
            <h3 class="text-2xl font-bold mb-2">
              <a
                href={`/blog/${post.slug}`}
                class="hover:text-accent transition-colors"
              >
                {post.data.title}
              </a>
            </h3>
            <p class="text-zinc-400 mb-3">{post.data.description}</p>
            <time class="text-sm text-zinc-500">
              {formatDate(post.data.pubDate)}
            </time>
          </article>
        ))
      }
    </div>
    <div class="mt-8">
      <a
        href="/blog"
        class="text-accent hover:underline inline-flex items-center gap-1"
      >
        Voir tous les articles ‚Üí
      </a>
    </div>
  </section>
</Layout>

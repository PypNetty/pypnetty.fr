---
// Fichier : src/pages/blog/index.astro
import { getCollection } from "astro:content";
import Footer from "../../components/Footer.astro";
import "../../styles/global.css";
import { BookOpen, Cpu, ArrowRight, Projector } from "lucide-react";

// 1. R√©cup√©ration des articles avec filtre (draft + date future)
const realPosts = await getCollection("blog", ({ data }) => {
  if (import.meta.env.DEV) return true;
  if (data.draft === true) return false;
  const today = new Date();
  today.setHours(0, 0, 0, 0);
  if (new Date(data.date) > today) return false;
  return true;
});

// 2. Formatage des vrais articles pour le design
const formattedRealPosts = realPosts.map((post) => ({
  title: post.data.title,
  slug: post.slug,
  type:
    post.data.type ||
    (post.data.tags?.includes("deep-dive") ? "deep-dive" : "kezako"),
  date: post.data.date,
  readTime: post.data.readTime || "5 min",
  category: post.data.category || post.data.tags?.[0] || "General",
  excerpt: post.data.excerpt,
  series: post.data.series,
  order: post.data.order,
  image: post.data.image,
  fileType: post.data.fileType || ".md",
  size: post.data.size || "4kb",
  permissions: "-rw-r--r--",
  isFeatured: post.data.isFeatured || false,
  tags: post.data.tags || [],
}));

// 3. Donn√©es Fictives (Pour l'exemple) - √† retirer quand vous aurez assez d'articles r√©els
const dummyPosts = [
  {
    title: "C'est quoi un Pod en r√©alit√© ?",
    slug: "kezako-pod",
    type: "kezako",
    date: "2026-02-12",
    readTime: "5 min",
    category: "Kubernetes 101",
    excerpt:
      "On confond souvent Conteneur et Pod. D√©mystification de l'unit√© atomique de K8s : pourquoi partager le localhost et les namespaces est vital.",
    isFeatured: false,
    fileType: ".md",
    size: "4kb",
    order: undefined,
    series: undefined,
    image: undefined,
    tags: [],
  },
  {
    title: "Deep Dive: Talos Boot Sequence",
    slug: "talos-boot-analysis",
    type: "deep-dive",
    date: "2026-01-28",
    readTime: "25 min",
    category: "OS Architecture",
    excerpt:
      "Analyse kernel de la s√©quence de d√©marrage d'un n≈ìud Talos. Du chargement de l'image initramfs en RAM jusqu'au premier appel API gRPC.",
    isFeatured: false,
    fileType: ".log",
    size: "128kb",
    order: undefined,
    series: undefined,
    image: undefined,
    tags: [],
  },
  {
    title: "GitOps : Arr√™tez de cliquer sur 'Apply'",
    slug: "kezako-gitops",
    type: "kezako",
    date: "2026-01-15",
    readTime: "7 min",
    category: "Methodology",
    excerpt:
      "Pourquoi kubectl apply est une dette technique. Comprendre la boucle de r√©conciliation de FluxCD et pourquoi Git doit √™tre la seule v√©rit√©.",
    isFeatured: false,
    fileType: ".txt",
    size: "6kb",
    order: undefined,
    series: undefined,
    image: undefined,
    tags: [],
  },
  {
    title: "Network : eBPF vs Iptables",
    slug: "deep-dive-ebpf",
    type: "deep-dive",
    date: "2025-12-10",
    readTime: "18 min",
    category: "Kernel Networking",
    excerpt:
      "Pourquoi Cilium remplace le proxy-mode. Regardons comment eBPF attache des programmes directement aux hooks du noyau pour router les paquets sans contexte switch.",
    isFeatured: false,
    fileType: ".o",
    size: "52kb",
    order: undefined,
    series: undefined,
    image: undefined,
    tags: [],
  },
];

// Fusion : Vrais articles + Faux
const posts = [...formattedRealPosts, ...dummyPosts];

const sagaPosts = posts
  .filter((post) => post.type === "saga")
  .sort(
    (a, b) =>
      (a.order ?? Number.MAX_SAFE_INTEGER) -
      (b.order ?? Number.MAX_SAFE_INTEGER),
  );

const techPosts = posts
  .filter((post) => post.type !== "saga")
  .sort((a, b) => new Date(b.date).getTime() - new Date(a.date).getTime());

const deepDivePosts = techPosts.filter((post) => post.type === "deep-dive");
const knowledgePosts = techPosts.filter((post) => post.type !== "deep-dive");
const kezakos = techPosts.filter((post) => post.type === "kezako");
---

<html lang="fr" class="scroll-smooth">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Engineering Logs | Pypnetty</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
  </head>

  <body
    class="bg-[#050608] text-white selection:bg-[#00D9A3] selection:text-black font-sans antialiased relative overflow-x-hidden"
  >
    <div class="fixed inset-0 z-0 pointer-events-none">
      <div
        class="absolute inset-0 bg-[linear-gradient(to_right,#8080800a_1px,transparent_1px),linear-gradient(to_bottom,#8080800a_1px,transparent_1px)] bg-[size:40px_40px]"
      >
      </div>
      <div
        class="absolute inset-0 bg-[radial-gradient(circle_at_center,transparent_0%,#050608_100%)]"
      >
      </div>
    </div>

    <nav
      class="fixed w-full z-50 border-b border-gray-800/50 bg-[#050608]/80 backdrop-blur-md"
    >
      <div
        class="max-w-7xl mx-auto px-4 h-16 flex items-center justify-between"
      >
        <a
          href="/"
          class="font-bold text-xl tracking-tight flex items-center gap-2 group"
        >
          <div
            class="w-8 h-8 bg-[#00D9A3] group-hover:bg-white transition-colors rounded-sm flex items-center justify-center text-black font-mono font-bold"
          >
            P
          </div>
          <span
            class="text-transparent bg-clip-text bg-gradient-to-r from-[#00D9A3] to-blue-600"
            >Pypnetty</span
          >
        </a>
        <div class="flex gap-6 text-xs font-mono text-gray-400">
          <a href="/" class="hover:text-white transition-colors">[~] Home</a>
          <a href="/projects" class="hover:text-white transition-colors"
            >[./] Projets</a
          >
          <span class="text-[#00D9A3] pointer-events-none">[*] Logs</span>
          <a href="/about" class="hover:text-white transition-colors"
            >[?] Profile</a
          >
        </div>
      </div>
    </nav>

    <main class="relative z-10 pt-32 pb-20 max-w-7xl mx-auto px-4">
      <div class="mb-16 border-b border-gray-800/50 pb-12">
        <div class="flex flex-col md:flex-row justify-between items-end gap-6">
          <div>
            <div
              class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-[#00D9A3]/10 border border-[#00D9A3]/20 text-[#00D9A3] text-xs font-mono mb-4 animate-pulse"
            >
              <span class="w-2 h-2 rounded-full bg-[#00D9A3]"></span>
              SYSTEM ONLINE ‚Ä¢ WRITING LOGS
            </div>
            <h1
              class="text-5xl md:text-6xl font-bold mb-4 tracking-tight text-white"
            >
              Engineering <span
                class="text-transparent bg-clip-text bg-gradient-to-r from-[#00D9A3] to-blue-600"
                >Logs</span
              >
            </h1>
            <p class="text-lg text-gray-400 max-w-xl">
              Base de connaissance immuable. Retours d'exp√©rience sur
              l'infrastructure bare-metal et l'orchestration.
            </p>
          </div>

          <div class="hidden md:flex gap-4 font-mono text-xs text-gray-500">
            <div class="bg-[#0d1117] border border-gray-800 p-3 rounded w-32">
              <div class="flex items-center gap-2 mb-1 text-gray-400">
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  ><rect x="4" y="4" width="16" height="16" rx="2" ry="2"
                  ></rect><rect x="9" y="9" width="6" height="6"></rect><line
                    x1="9"
                    y1="1"
                    x2="9"
                    y2="4"></line><line x1="15" y1="1" x2="15" y2="4"
                  ></line><line x1="9" y1="20" x2="9" y2="23"></line><line
                    x1="15"
                    y1="20"
                    x2="15"
                    y2="23"></line><line x1="20" y1="9" x2="23" y2="9"
                  ></line><line x1="20" y1="14" x2="23" y2="14"></line><line
                    x1="1"
                    y1="9"
                    x2="4"
                    y2="9"></line><line x1="1" y1="14" x2="4" y2="14"
                  ></line></svg
                >
                CPU Load
              </div>
              <div class="text-[#00D9A3] text-lg">12%</div>
            </div>
            <div class="bg-[#0d1117] border border-gray-800 p-3 rounded w-32">
              <div class="flex items-center gap-2 mb-1 text-gray-400">
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  ><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"
                  ></polyline></svg
                >
                Uptime
              </div>
              <div class="text-blue-400 text-lg">41d 12h</div>
            </div>
            <div class="bg-[#0d1117] border border-gray-800 p-3 rounded w-32">
              <div class="flex items-center gap-2 mb-1 text-gray-400">
                <svg
                  width="14"
                  height="14"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  ><line x1="22" y1="12" x2="2" y2="12"></line><path
                    d="M5.45 5.11L2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z"
                  ></path><line x1="6" y1="16" x2="6.01" y2="16"></line><line
                    x1="10"
                    y1="16"
                    x2="10.01"
                    y2="16"></line></svg
                >
                Storage
              </div>
              <div class="text-purple-400 text-lg">1.2 TB</div>
            </div>
          </div>
        </div>
      </div>

      <section class="mb-20">
        <div class="flex items-center justify-between mb-6 px-4">
          <h2
            class="text-2xl font-bold text-white tracking-tight flex items-center gap-3"
          >
            <span class="text-cyan-400 animate-pulse">‚óè</span>
            KUBERIA_CHRONICLES
          </h2>
          <div class="flex gap-2">
            <div class="h-2 w-2 rounded-full bg-cyan-500"></div>
            <div class="h-2 w-2 rounded-full bg-cyan-900"></div>
            <div class="h-2 w-2 rounded-full bg-cyan-900"></div>
          </div>
        </div>

        <div
          class="flex overflow-x-auto pb-8 gap-6 px-4 snap-x snap-mandatory custom-scrollbar scroll-smooth"
        >
          {
            sagaPosts.map((post) => (
              <div class="snap-center shrink-0 w-[85vw] md:w-[600px] relative group transition-all duration-500 hover:scale-[1.01]">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-xl opacity-0 group-hover:opacity-50 blur transition duration-500" />

                <div class="relative h-full bg-[#0d1117] border border-gray-800 rounded-xl overflow-hidden flex flex-col md:flex-row">
                  <div class="absolute inset-0 md:relative md:w-2/3 h-64 md:h-auto">
                    {post.image ? (
                      <img
                        src={post.image}
                        alt={post.title}
                        class="w-full h-full object-cover opacity-60 group-hover:opacity-100 transition duration-700"
                      />
                    ) : (
                      <div class="w-full h-full bg-gradient-to-br from-[#0d1117] via-[#0b0f14] to-[#050608]" />
                    )}
                    <div class="absolute inset-0 bg-gradient-to-t from-[#0d1117] via-transparent to-transparent md:bg-gradient-to-r md:from-transparent md:to-[#0d1117]" />
                  </div>

                  <div class="relative z-10 p-6 flex flex-col justify-end md:justify-center md:w-1/3 bg-gradient-to-t from-[#0d1117] via-[#0d1117]/80 to-transparent md:bg-none">
                    <div class="text-[10px] font-mono text-cyan-500 mb-2 flex items-center gap-2">
                      <span class="px-1.5 py-0.5 border border-cyan-500/30 rounded bg-cyan-900/10">
                        EP.{String(post.order ?? 0).padStart(2, "0")}
                      </span>
                      <span>{post.date}</span>
                    </div>

                    <h3 class="text-xl md:text-2xl font-bold text-white mb-2 leading-tight group-hover:text-cyan-400 transition-colors">
                      <a href={`/blog/${post.slug}`}>
                        <span class="absolute inset-0" />
                        {post.title}
                      </a>
                    </h3>

                    <p class="hidden md:block text-gray-400 text-xs line-clamp-3 mb-4 font-mono">
                      {post.excerpt}
                    </p>

                    <div class="flex items-center text-xs font-bold text-white mt-auto">
                      <span class="border-b border-cyan-500 pb-0.5">
                        LAUNCH_SIMULATION
                      </span>
                      <svg
                        class="w-4 h-4 ml-2 text-cyan-500 group-hover:translate-x-2 transition-transform"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          stroke-width="2"
                          d="M17 8l4 4m0 0l-4 4m4-4H3"
                        />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
            ))
          }

          <div
            class="snap-center shrink-0 w-[200px] flex items-center justify-center border border-dashed border-gray-800 rounded-xl bg-white/5 text-gray-500 font-mono text-xs"
          >
            <span>// NEXT_EPISODE_LOADING...</span>
          </div>
        </div>
      </section>

      <section class="relative mt-20">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-12">
          <div class="lg:col-span-8 space-y-8">
            <div
              class="flex items-center gap-3 mb-6 border-b border-gray-800 pb-4"
            >
              <span class="text-purple-400 text-xl">‚ö°</span>
              <h2
                class="text-2xl font-bold text-white tracking-tight font-mono"
              >
                /CORE/DEEP_DIVES
              </h2>
              <span class="text-xs text-gray-500 font-mono mt-1 ml-auto">
                {deepDivePosts.length} FILES FOUND
              </span>
            </div>

            <div class="space-y-6">
              {
                deepDivePosts.map((post) => (
                  <a
                    href={`/blog/${post.slug}`}
                    class="group block relative bg-[#0d1117] border border-gray-800 hover:border-purple-500/50 rounded-xl overflow-hidden transition-all duration-300 hover:shadow-[0_0_30px_rgba(168,85,247,0.1)]"
                  >
                    <div class="p-6 md:p-8 flex flex-col md:flex-row gap-6">
                      <div class="md:w-32 shrink-0 flex flex-col gap-2 font-mono text-xs text-gray-500 border-b md:border-b-0 md:border-r border-gray-800 pb-4 md:pb-0 md:pr-4">
                        <span class="text-purple-400 font-bold">rw-r--r--</span>
                        <span>
                          {new Date(post.date).toLocaleDateString("fr-FR", {
                            month: "short",
                            day: "numeric",
                          })}
                        </span>
                        <span>{post.size || "4KB"}</span>
                        <span class="mt-auto hidden md:block group-hover:text-purple-400 transition-colors">
                          ./OPEN
                        </span>
                      </div>

                      <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                          <span class="px-2 py-0.5 rounded text-[10px] font-bold bg-purple-500/10 text-purple-400 border border-purple-500/20 uppercase tracking-widest">
                            Analysis
                          </span>
                        </div>
                        <h3 class="text-xl md:text-2xl font-bold text-gray-200 group-hover:text-white mb-3 leading-tight">
                          {post.title}
                        </h3>
                        <p class="text-gray-400 text-sm leading-relaxed line-clamp-2">
                          {post.excerpt}
                        </p>
                      </div>
                    </div>
                  </a>
                ))
              }
            </div>
          </div>

          <div class="lg:col-span-4">
            <div class="sticky top-8">
              <div
                class="flex items-center gap-3 mb-6 border-b border-gray-800 pb-4"
              >
                <span class="text-yellow-400 text-xl">üí°</span>
                <h2
                  class="text-xl font-bold text-white tracking-tight font-mono"
                >
                  /VAR/QUICK_TIPS
                </h2>
              </div>

              <div
                class="bg-[#161b22]/50 border border-gray-800 rounded-xl p-1"
              >
                {
                  kezakos.map((post) => (
                    <a
                      href={`/blog/${post.slug}`}
                      class="group flex items-start gap-3 p-4 rounded-lg hover:bg-white/5 transition-colors border-b border-gray-800/50 last:border-0"
                    >
                      <div class="mt-1 text-gray-600 group-hover:text-yellow-400 transition-colors">
                        <svg
                          class="w-4 h-4"
                          fill="none"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                        >
                          <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
                          />
                        </svg>
                      </div>

                      <div>
                        <h4 class="text-sm font-bold text-gray-300 group-hover:text-white transition-colors leading-snug mb-1">
                          {post.title}
                        </h4>
                        <div class="flex flex-wrap gap-2">
                          {post.tags?.slice(0, 2).map((tag: string) => (
                            <span class="text-[10px] text-gray-500 font-mono">
                              #{tag}
                            </span>
                          ))}
                        </div>
                      </div>
                    </a>
                  ))
                }

                <a
                  href="/category/basics"
                  class="block text-center py-3 text-xs font-mono text-gray-500 hover:text-white border-t border-dashed border-gray-800 hover:bg-white/5 transition-colors rounded-b-lg"
                >
                  LOAD_MORE_RECORDS...
                </a>
              </div>

              <div
                class="mt-6 p-4 rounded-lg bg-blue-900/10 border border-blue-500/20 text-xs font-mono text-blue-300"
              >
                <div class="flex justify-between mb-2">
                  <span>SYSTEM_MEMORY</span>
                  <span>32%</span>
                </div>
                <div
                  class="w-full bg-gray-800 h-1 rounded-full overflow-hidden"
                >
                  <div class="bg-blue-500 h-full w-[32%]"></div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
    <Footer />
  </body>
</html>

---
// GitOpsWorkflowSection.astro - GitOps workflow visualization
---

<section class="py-20 bg-gray-900/30 border-y border-gray-800">
  <div class="max-w-7xl mx-auto px-4">
    <div class="text-center mb-16">
      <h2 class="text-3xl font-bold text-white mb-4">The GitOps Workflow</h2>
      <p class="text-gray-400 max-w-2xl mx-auto">
        L'infrastructure est définie comme du code. Le cluster ne fait que
        converger vers cet état. Si un humain modifie le serveur manuellement,
        le cluster annule la modification.
      </p>
    </div>

    <!-- Pipeline Visualisation -->
    <div class="grid grid-cols-1 md:grid-cols-4 gap-4 relative">
      <!-- Step 1: CODE -->
      <div
        class="bg-[#0d1117] border border-gray-800 p-6 rounded-lg relative group hover:border-[#00D9A3] transition-all"
      >
        <div
          class="absolute -top-3 left-6 bg-[#1F2937] px-2 text-xs font-mono text-gray-400"
        >
          01. SOURCE
        </div>
        <div class="text-[#00D9A3] font-mono font-bold text-xl mb-2">
          git push
        </div>
        <p class="text-sm text-gray-400">
          Tout changement (infra ou app) commence par un commit. Pull Request
          validée = déploiement initié.
        </p>
        <!-- Arrow for Desktop -->
        <div class="hidden md:block absolute top-1/2 -right-6 text-gray-700">
          →
        </div>
      </div>

      <!-- Step 2: RECONCILE -->
      <div
        class="bg-[#0d1117] border border-gray-800 p-6 rounded-lg relative group hover:border-[#00D9A3] transition-all"
      >
        <div
          class="absolute -top-3 left-6 bg-[#1F2937] px-2 text-xs font-mono text-gray-400"
        >
          02. DETECT
        </div>
        <div class="text-blue-400 font-mono font-bold text-xl mb-2">
          Loop detection
        </div>
        <p class="text-sm text-gray-400">
          Le contrôleur GitOps détecte la dérive (Drift) entre le dépôt Git et
          l'état actuel du cluster.
        </p>
        <!-- Arrow for Desktop -->
        <div class="hidden md:block absolute top-1/2 -right-6 text-gray-700">
          →
        </div>
      </div>

      <!-- Step 3: APPLY -->
      <div
        class="bg-[#0d1117] border border-gray-800 p-6 rounded-lg relative group hover:border-[#00D9A3] transition-all"
      >
        <div
          class="absolute -top-3 left-6 bg-[#1F2937] px-2 text-xs font-mono text-gray-400"
        >
          03. CONVERGE
        </div>
        <div class="text-purple-400 font-mono font-bold text-xl mb-2">
          Talos Apply
        </div>
        <p class="text-sm text-gray-400">
          Application atomique de la configuration. Mise à jour de l'OS, des
          routes réseau ou des pods.
        </p>
        <!-- Arrow for Desktop -->
        <div class="hidden md:block absolute top-1/2 -right-6 text-gray-700">
          →
        </div>
      </div>

      <!-- Step 4: HEAL -->
      <div
        class="bg-[#0d1117] border border-green-900/30 p-6 rounded-lg relative group hover:border-[#00D9A3] transition-all bg-green-900/5"
      >
        <div
          class="absolute -top-3 left-6 bg-[#1F2937] px-2 text-xs font-mono text-[#00D9A3]"
        >
          04. RESILIENCE
        </div>
        <div class="text-white font-mono font-bold text-xl mb-2">
          Self-Healing
        </div>
        <p class="text-sm text-gray-400">
          Si un nœud tombe, le système le remplace. Si un pod crash, il
          redémarre. L'état désiré est maintenu.
        </p>
      </div>
    </div>

    <!-- Code Snippet Decoratif en dessous -->
    <div
      class="mt-12 bg-black rounded-lg p-4 font-mono text-xs text-gray-500 overflow-x-auto border border-gray-800"
    >
      <div class="flex gap-4 border-b border-gray-800 pb-2 mb-2">
        <span>kustomization.yaml</span>
      </div>
      <div>
        <span class="text-purple-400">apiVersion</span>:
        kustomize.toolkit.fluxcd.io/v1<br />
        <span class="text-purple-400">kind</span>: Kustomization<br />
        <span class="text-purple-400">metadata</span>:<br />
        &nbsp;&nbsp;<span class="text-blue-400">name</span>: infra-core<br />
        <span class="text-purple-400">spec</span>:<br />
        &nbsp;&nbsp;<span class="text-blue-400">interval</span>: 1m0s<br />
        &nbsp;&nbsp;<span class="text-blue-400">sourceRef</span>:<br />
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="text-blue-400">kind</span>:
        GitRepository<br />
        &nbsp;&nbsp;&nbsp;&nbsp;<span class="text-blue-400">name</span>:
        pypstack-system
      </div>
    </div>
  </div>
</section>
